\newpage
\chapter{Condición de exactitud y factores integrales}
Una vez estudiados los principales cambios de variable para resolver ecuaciones diferenciales, cambiamos ahora la forma en la que las resolveremos, procedimiento que describiremos y desarrollaremos a lo largo de este Capítulo.

\begin{notacion}
    Volveremos nuevamente a la notación geométrica, donde notaremos por $x$ a la variable independiente y por $y = y(x)$ a la función incógnita.
\end{notacion}

Ahora, no estaremos interesados en buscar ecuaciones diferenciales en forma normal, sino que buscaremos ecuaciones de la forma
\begin{equation}\label{eq:nueva_forma}
    P(x,y) + Q(x,y)y' = 0
\end{equation}
Y lo que haremos ahora para resolverla será buscar diferenciales exactas, es decir, buscar una función $U$ de forma que la expresión~(\ref{eq:nueva_forma}) se reescriba como
\begin{equation*}
    \dfrac{d}{dx}[U(x,y)] = 0
\end{equation*}
De forma que, bajo unas ciertas condiciones, tendremos que $U(x,y)= c$, $c\in \mathbb{R}$ con lo que tendremos una solución $y=y(x)$ expresada en forma implícita gracias a la función $U$.

\begin{ejemplo}
    Motivaremos lo anteriormente descrito con este ejemplo, en el que trataremos de resolver la ecuación
    \begin{equation}\label{eq:ejemplo_dif_ex}
        \dfrac{dy}{dx} = \dfrac{y-x}{y+x}
    \end{equation}
    buscando para ello una función que al derivarla respecto a $x$ nos de la expresión que tenemos.

    Lo primero para ello será reescribir la ecuación~(\ref{eq:ejemplo_dif_ex}) para que sea de la forma~(\ref{eq:nueva_forma}). Para ello, es suficiente con desplazar todos los términos a la izquierda de la igualdad, obteniendo
    \begin{equation}\label{eq:ejemplo_dif_ex2}
        x-y+(x+y)y' = 0
    \end{equation}
    Por lo que en este caso, tenemos las funciones
    \begin{equation*}
        P(x,y) = x-y \qquad Q(x,y) = x+y
    \end{equation*}
    Reescribiendo la ecuación~(\ref{eq:ejemplo_dif_ex2}) con el objetivo de buscar un diferencial exacto, llegamos a la expresión
    \begin{equation*}
        x+yy' - y+xy' = 0
    \end{equation*}
    donde observamos que la parte de la izquierda de la resta podemos verla como:
    \begin{equation*}
        x+yy' = 0 \Longrightarrow \dfrac{d}{dx}\left(\dfrac{x^2+y^2}{2}\right) = 0
    \end{equation*}
    Si también pudiéramos hacerlo también en la derecha (algo que a priori parece más difícil), llegaríamos a una expresión de la forma:
    \begin{equation*}
        \dfrac{d}{dx}\left(\dfrac{x^2+y^2}{2}\right) - \dfrac{d}{dx}[H(x,y)] = 0
    \end{equation*}
    Veremos próximamente que esto es imposible de hacer en este caso.

    Sin embargo, existe un truco que sí nos permite resolver la ecuación~(\ref{eq:ejemplo_dif_ex2}), se basa en dividir la expresión entre $x^2+y^2$ (algo que por ahora parece una idea feliz, pero que cobrará sentido a lo largo del Capítulo, algo que llamaremos \textit{factor integrante}):
    \begin{equation*}
        \dfrac{x-y}{x^2+y^2} + \dfrac{x+y}{x^2+y_2}y' = 0
    \end{equation*}
    Vamos a reorganizar los términos cuidadosamente, para buscar un diferencial exacto:
    \begin{equation*}
        \dfrac{x+yy'}{x^2+y^2} + \dfrac{-y+xy'}{x^2+y^2} = 0
    \end{equation*}
    Es difícil hallar un diferencial exacto a partir de una expresión, pero es fácil comprobar que algo lo sea. Proponemos la siguiente expresión como diferencial exacto y comprobaremos que funciona, por tener por ahora poco manejo en este procedimiento (aunque el término de la izquierda no es difícil de averiguar). Proponemos:
    \begin{equation*}
        \dfrac{d}{dx}\left(\dfrac{1}{2}\ln(x^2+y^2)\right) + \dfrac{d}{dx}\left(\arctg\left(\dfrac{y}{x}\right)\right) = 0
    \end{equation*}
    Es sencillo comprobar que el término de la izquierda se corresponde con lo que queríamos hacer, comprobémoslo ahora en la derecha:
    \begin{equation*}
        \dfrac{d}{dx}\left(\arctg\left(\dfrac{y}{x}\right)\right) = \dfrac{1}{1+{\left(\dfrac{y}{x}\right)}^{2}} \dfrac{xy'-y}{x^2} = \dfrac{xy'-y}{x^2+y^2}
    \end{equation*}
    Finalmente, vemos que:
    \begin{equation*}
        \dfrac{d}{dx}\left(\dfrac{1}{2}\ln(x^2+y^2)+\arctg\left(\dfrac{y}{x}\right)\right) = \dfrac{d}{dx}\left(\dfrac{1}{2}\ln(x^2+y^2)\right) + \dfrac{d}{dx}\left(\arctg\left(\dfrac{y}{x}\right)\right) = 0
    \end{equation*}
    gracias a la linealidad de la derivada, y por ser la función\footnote{En este ejemplo no nos preocupamos por su intervalo de definición, ya que solo queremos mostrar el procedimiento que realizaremos a partir de ahora para resolver las ecuaciones diferenciales.}
    \begin{equation*}
        (x,y) \longmapsto \dfrac{1}{2}\ln(x^2+y^2) + \arctg\left(\dfrac{y}{x}\right)
    \end{equation*}
    de clase $C^1$, concluimos finalmente que
    \begin{equation*}
        \dfrac{1}{2}\ln(x^2+y^2) + \arctg\left(\dfrac{y}{x}\right) = c \qquad c\in \mathbb{R}
    \end{equation*}
\end{ejemplo}
Una vez explicada de forma breve lo que haremos y motivada con el ejemplo anterior, pasaremos ahora al desarrollo teórico de este procedimiento, el cual se divide en dos:
\begin{itemize}
    \item En primer lugar, estudiar una condición necesaria y suficiente para tener la condición de exactitud (esto es, poder encontrar un diferencial exacto) que nos permita obtener la función $U$ anteriormente mencionada.
    \item En caso de que no podemos hacerlo, buscar algo por lo que multiplicar la ecuación original (un factor integrante) para que sí podamos hacerlo, tal y como hicimos en el ejemplo con $x^2+y^2$.
\end{itemize}
Exigiremos varias hipótesis sobres las funciones $P$ y $Q$ de la expresión~(\ref{eq:nueva_forma}) (y sobre otros elementos relacionados con la ecuación diferencial) con el fin de obtener el resultado buscado.

\section{Condición de exactitud}
En todo lo que sigue, trabajaremos en un abierto conexo $\Omega\subseteq \mathbb{R}^2$ y con dos funciones\footnote{Notemos que en el ejemplo anterior, $P$ y $Q$ eran polinomios, por lo que cumplian esta condición.} $P,Q\in C^1(\Omega)$.\\

Si existe $U\in C^1(\Omega)$ una función de dos variables de forma que la ecuación~(\ref{eq:nueva_forma}) se transforme en una de la forma:
\begin{equation*}
    \dfrac{d}{dx}(U(x,y)) = 0
\end{equation*}
Derivando de forma implícita:
\begin{equation*}
    \dfrac{\partial U}{\partial x}(x,y) + \dfrac{\partial U}{\partial y}(x,y)y' = 0
\end{equation*}
Por tanto, lo que buscamos es una función $U$ que cumpla:
\begin{equation*}
    \dfrac{\partial U}{\partial x} = P \qquad \dfrac{\partial U}{\partial y} = Q
\end{equation*}
Veremos a continuación que esto no es posible en general (sin exigir más condiciones). Es decir, no tiene por qué existir una funcion $U$ de forma que sus dos parciales sean las funciones $P$ y $Q$ dadas. Para ello, recuperaremos el ejemplo anterior, introduciendo antes un teorema importante en esta sección\footnote{Se trata de un Teorema que se debería haber visto anteriormente, pero que no se ha hecho por la planificación del doble grado.}.

\begin{teo}[de Clairaut]
    Sea $f:\Omega \rightarrow \mathbb{R}$ una función de dos variables definida en un conjunto abierto $\Omega\subseteq \mathbb{R}^2$, si $f\in C^2(\Omega)$, entonces las derivadas cruzadas de $f$ son iguales, es decir:
    \begin{equation*}
        \dfrac{\partial^2 f}{\partial x\partial y} = \dfrac{\partial^2 f}{\partial y\partial x}
    \end{equation*}
\end{teo}

\begin{ejemplo}
    Para las funciones
    \begin{equation*}
        P(x,y) = x-y \qquad Q(x,y) = x+y
    \end{equation*}
    no es posible encontrar una función $U\in C^1(\mathbb{R}^2)$ que cumpla
    \begin{equation*}
        \dfrac{\partial U}{\partial x}(x,y) = P(x,y) \qquad \dfrac{\partial U}{\partial y}(x,y) = Q(x,y) \qquad \forall (x,y)\in \mathbb{R}^2
    \end{equation*}
    \begin{proof}
        Por reducción al absurdo, suponemos que existe una función $U$ de forma que
    \begin{equation*}
        \dfrac{\partial U}{\partial x}(x,y) = P(x,y) = x-y \qquad \dfrac{\partial U}{\partial y}(x,y) = Q(x,y) = x+y \qquad \forall (x,y)\in \mathbb{R}^2
    \end{equation*}
    En dicho caso, entonces $U\in C^2(\mathbb{R}^2)$ (de hecho, $U\in C^\infty(\mathbb{R}^2)$ por tratarse de polinomios). Notemos que:
    \begin{align*}
        \dfrac{\partial^2 U}{\partial x\partial y}(x,y) &= \dfrac{\partial }{\partial x}\left(\dfrac{\partial U}{\partial y}(x,y)\right) = \dfrac{\partial }{\partial x}(Q(x,y)) = 1 \qquad \forall (x,y)\in \mathbb{R}^2 \\
        \dfrac{\partial^2 U}{\partial y\partial x}(x,y) &= \dfrac{\partial }{\partial y}\left(\dfrac{\partial U}{\partial x}(x,y)\right) = \dfrac{\partial }{\partial y}(P(x,y)) = -1 \qquad \forall (x,y)\in \mathbb{R}^2 
    \end{align*}
    Por el Teorema de Clairaut, llegamos a que:
    \begin{equation*}
        1 = \dfrac{\partial^2 U}{\partial x\partial y}(x,y) = \dfrac{\partial^2 U}{\partial y\partial x}(x,y) = -1 \qquad \forall (x,y)\in \mathbb{R}^2
    \end{equation*}
    Contradicción, con lo que no existe dicha función $U$.
    \end{proof}
\end{ejemplo}

En general, dadas dos funciones de clase $C^1$ no podemos encontrar una tercera función de clase $C^1$ de forma que sus derivadas parciales sean las dos primeras funciones. Notemos que en el caso unidimensional, el Teorema Fundamental del Cálculo nos asegura que esto sí que es cierto, cosa que no pasa en varias variables.\\

Buscamos ahora una condición que nos permita encontrar una función $U\in C^1(\Omega)$ de forma que podamos escribir
\begin{equation*}
    \dfrac{\partial U}{\partial x} = P \qquad \dfrac{\partial U}{\partial y} = Q 
\end{equation*}
Para dos funciones $P$ y $Q$ de clase $C^1(\Omega)$. Veamos primero un resultado que nos da una condición necesaria:

\begin{prop}[Condición necesaria]\label{prop:condicion_necesaria}
    Dadas dos funciones $P,Q\in C^1(\Omega)$, si existe una función $U\in C^1(\Omega)$ tal que 
\begin{equation*}
    \dfrac{\partial U}{\partial x}(x,y) = P(x,y) \qquad \dfrac{\partial U}{\partial y}(x,y) = Q(x,y) \qquad \forall (x,y)\in \mathbb{R}^2
\end{equation*}
Entonces, se ha de cumplir la \textbf{condición de exactitud}:
    \begin{equation*}
        \dfrac{\partial P}{\partial y}(x,y) = \dfrac{\partial Q}{\partial x}(x,y) \qquad \forall (x,y)\in \mathbb{R}^2
    \end{equation*}
    \begin{proof}
        Recuperando parte de la demostración del ejemplo anterior, si existiera dicha función $U$, esta sería de clase $C^2(\Omega)$, luego aplicando el Teorema de Clairaut:
        \begin{equation*}
            \dfrac{\partial Q}{\partial x} = \dfrac{\partial }{\partial x}\left(\dfrac{\partial U}{\partial y}\right)= \dfrac{\partial^2 U}{\partial x\partial y} = \dfrac{\partial^2 U}{\partial y \partial x} = \dfrac{\partial}{\partial y}\left(\dfrac{\partial U}{\partial x}\right) = \dfrac{\partial P}{\partial y}
        \end{equation*}
    \end{proof}
\end{prop}

Sin embargo, la condición de exactitud no se trata de una condición suficiente para poder encontrar dicha función $U$, sino que dependerá de la topología de $\Omega$ de que esto pueda hacerse o no. Para ver este resultado, es necesario introducir previamente un concepto ya visto en otras asignaturas.

\begin{definicion}[Forma de estrella]
    Diremos que $\Omega$ tiene forma de estrella (o que es estrellado\footnote{Tal y como se desarrolló en los apuntes de Topología I.}) si existe $z_\ast \in \Omega$ tal que 
    \begin{equation*}
        [z,z_\ast] \subseteq  \Omega \qquad \forall z\in \Omega
    \end{equation*}

    Es decir, que el segmento de extremos $z$ y $z_\ast$ esté contenido en $\Omega$:
    \begin{equation*}
        (1-t)z + tz_\ast \in \Omega \qquad \forall t\in [0,1], z\in \Omega
    \end{equation*}
\end{definicion}

Notemos que la condición de ser estrellado se trata de una condicion geométrica. Ejemplos de conjuntos estrellados son:
\begin{equation*}
    \mathbb{R}^2 \qquad [0,1]\times [0,1] \qquad \mathbb{S}^1
\end{equation*}
Todos estos son convexos. Sin embargo, existen conjuntos con forma de estrella que no son convexos, como el conjunto de la Figura~\ref{fig:Estrellado}.
\begin{figure}[H]
    \centering
    \begin{tikzpicture}[scale=0.4]
        % Dibujo de una estrella
        \coordinate (A) at (0,8);
        \coordinate (B) at (2,3);
        \coordinate (C) at (7,3);
        \coordinate (D) at (3,0);
        \coordinate (E) at (4,-6);
        \coordinate (F) at (0,-3);
        \coordinate (G) at (-4,-6);
        \coordinate (H) at (-3,0);
        \coordinate (I) at (-7,3);
        \coordinate (J) at (-2,3);

        \draw (A) -- (B) -- (C) -- (D) -- (E) -- (F) -- (G) -- (H) -- (I) -- (J) -- cycle;

        \coordinate (X) at (0,0);
        \coordinate (P) at (3,2);
        \coordinate (Q) at (-2,-3);

        % Marca cada punto
        \fill (X) circle (4pt) node[anchor=south east]{$z_\ast$};
        \fill (P) circle (2pt);
        \fill (Q) circle (2pt);

        % Dibujo de los segmentos
        \draw[dashed] (X) -- (P);
        \draw[dashed] (X) -- (Q);
    \end{tikzpicture}
    \caption{Conjunto estrellado desde $z_\ast$.}
    \label{fig:Estrellado}
\end{figure}

Recordando la Proposición~\ref{prop:condicion_necesaria}, mostramos ahora el siguiente teorema, el cual nos proporciona la otra implicación que venimos buscando para tener una condición necesaria y \underline{suficiente}.
\begin{teo}\label{teo:condicion_suficiente}
    Si $\Omega\subseteq \mathbb{R}^2$ es abierto y tiene forma de estrella, sean $P,Q\in C^1(\Omega)$ funciones que cumplen la condición de exactitud, es decir, que:
    \begin{equation*}
        \dfrac{\partial P}{\partial y}(x,y) = \dfrac{\partial Q}{\partial x}(x,y) \qquad \forall (x,y)\in \mathbb{R}^2
    \end{equation*}
    Entonces, existe una función $U\in C^2(\Omega)$ tal que 
    \begin{equation*}
        \dfrac{\partial U}{\partial x}(x,y) = P(x,y) \qquad \dfrac{\partial U}{\partial y}(x,y) = Q(x,y) \qquad \forall (x,y)\in \mathbb{R}^2
    \end{equation*}
\end{teo}
\noindent
En realidad, obtenemos un teorema mucho más general exigiendo solo que $\Omega$ sea simplemente conexo\footnote{Noción que no hemos visto todavía. Intuitivamente, un conjunto es simplemente conexo si no tiene agujeros.}.\\

Para realizar la demostración, es necesario recordar previamente un concepto ya visto en Análisis Matemático II\@, las integrales dependientes de un parámetro.
\subsection{Integrales dependientes de un parámetro}
Sabemos que si tenemos una función continua $f$ definida en un intervalo $I$, entonces si definimos
\begin{equation*}
    F(y) = \int_{y_0}^{y} f(\xi)~d\xi  \qquad y_0\in I, \forall y\in I
\end{equation*}
Sabemos por el Teorema Fundametal del Cálculo que $F\in C^1(I)$, con $F'(y) = f(y)$.\\

Sin embargo, nos podemos encontrar funciones definidas por integrales de diversas formas, como una función dada por la integral de una función de dos variables integrando solo una de ellas. Sea $f:J\times I\rightarrow\mathbb{R}$ una función y $a,b\in J$, definimos $F:I\rightarrow\mathbb{R}$ por
\begin{equation*}
    F(y) = \int_{a}^{b} f(x,y)~dx  \qquad \forall y\in I
\end{equation*}
Las funciones obtenidas de esta forma decimos que son funciones obtenidas mediante integrales dependientes de un parámetro (en este caso, el parámetro es $y$).\\

Antes de ver cómo podemos derivar este tipo de funciones, pensaremos en ``el caso discreto''. Es decir, dada una sucesión de funciones ${\{f_n\}}_{n\in \mathbb{N}}$ todas ellas definidas en un cierto intervalo $I$ y dado $N\in \mathbb{N}$, podemos definir una función $F:I\rightarrow\mathbb{R}$ dada por
\begin{equation*}
    F(y) = \sum_{n=1}^{N} f_n(y) \qquad \forall y\in I
\end{equation*}
De esta forma, sabemos ya derivar la función $F$:
\begin{equation*}
    \dfrac{dF}{dy}(y) = \dfrac{d}{dy}\left(\sum_{n=1}^{N}f_n(y)\right) = \sum_{n=1}^{N}\left(\dfrac{df_n}{dy}(y)\right) \qquad \forall y\in I
\end{equation*}

gracias a la linealidad de la derivada. Resulta que esto se mantiene al pasar al ``caso continuo'', tal y como veremos en el siguiente teorema.\\

Veremos una versión más débil del teorema visto en Análisis Matemático II, que cuenta con las consecuencias justas para demostrar el Teorema~\ref{teo:condicion_suficiente}.
\begin{teo}[Integral dependiente de un parámetro]
    Sea $G\subseteq \mathbb{R}^d$ un conjunto abierto, dada una aplicación $f:G\times [a,b]\rightarrow\mathbb{R}$ de clase $C^1(G\times [a,b])$, definimos una función $F:G\rightarrow\mathbb{R}$ dada por
\begin{equation*}
    F(\xi_1, \xi_2, \ldots, \xi_d) = \int_{a}^{b} f(\xi_1, \xi_2, \ldots, \xi_d, t)~dt
\end{equation*}
Entonces, $F\in C^1(G)$ y 
\begin{equation*}
    \dfrac{\partial F}{\partial \xi_i}(\xi_1, \xi_2, \ldots, \xi_d) = \int_{a}^{b} \dfrac{\partial f}{\partial \xi_i}(\xi_1, \xi_2, \ldots, \xi_d, t)~dt \qquad \forall i \in \{1,\ldots, d\}
\end{equation*}
\end{teo}

\noindent
Como consecuencia del teorema, la función $F$ anteriormente definida como
\begin{equation*}
    F(y) = \int_{a}^{b} f(x,y)~dx \qquad \forall y\in I
\end{equation*}
Si $I$ era un intervalo abierto y $f$ era de clase\footnote{Notemos que el teorema se anunció pensando que los parámetros de la función serían los primeros, pero ahora tenemos el parámetro al final, es una situación totalmente análoga.} $C^1([a,b]\times I)$, entonces $F\in C^1(I)$, y tenemos que 
\begin{equation*}
    F'(y) = \int_{a}^{b} \dfrac{\partial f}{\partial y}(x,y)~dx  \qquad \forall y\in I
\end{equation*}

\begin{ejemplo}
    Dada la función
    \begin{equation*}
        F(y) = \int_{0}^{1} e^x \sen(x+y^2)~dx \qquad \forall y\in I
    \end{equation*}
    Gracias al teorema de integrales dependientes de un parámetro, sabemos que la derivada de esta función es:
    \begin{equation*}
        F'(y) = \int_{0}^{1} 2ye^x \cos(x+y^2)~dx = 2y\int_{0}^{1} e^x \cos(x+y^2)~dx \qquad \forall y\in \mathbb{R}
    \end{equation*}
\end{ejemplo}

Una vez terminado el repaso de integrales dependientes de un parámetro, estamos ya preparados para proceder con la demostracion del Teorema~\ref{teo:condicion_suficiente}, el cual volvemos a enunciar:
\begin{teo}
    Si $\Omega\subseteq \mathbb{R}^2$ es abierto y tiene forma de estrella, sean $P,Q\in C^1(\Omega)$ funciones que cumplen la condición de exactitud, es decir, que:
    \begin{equation*}
        \dfrac{\partial P}{\partial y}(x,y) = \dfrac{\partial Q}{\partial x}(x,y) \qquad \forall (x,y)\in \mathbb{R}^2
    \end{equation*}
    Entonces, existe una función $U\in C^2(\Omega)$ tal que 
    \begin{equation*}
        \dfrac{\partial U}{\partial x}(x,y) = P(x,y) \qquad \dfrac{\partial U}{\partial y}(x,y) = Q(x,y) \qquad \forall (x,y)\in \mathbb{R}^2
    \end{equation*}
    \begin{proof}
        La demostración la haremos pensando que el punto $z_\ast$ de $\Omega$ que nos da la condición de que tenga forma de estrella sea $z_\ast = (0,0)$ y la demostración en el caso general se deja como ejercicio para el lector.

        En dicho caso, definimos una función $U:\Omega\rightarrow\mathbb{R}$ dada por
        \begin{equation*}
            U(x,y) = x\int_{0}^{1} P(\lm x,\lm y)~d\lm + y\int_{0}^{1} Q(\lm x,\lm y)~d\lm  \qquad \forall (x,y)\in \Omega
        \end{equation*}
        Notemos que $U$ está bien definida, ya que: 
        \begin{itemize}
            \item En primer lugar, como $\Omega$ tiene forma de estrella desde $z_\ast = (0,0)$, entonces el segmento que une cualquier punto $(x,y)$ con $z_\ast$ estará en $\Omega$, luego si $(x,y)\in \Omega$, entonces $(\lm x,\lm y)\in \Omega$ $\forall \lm\in [0,1]$.
            \item Ademś, $P$ y $Q$ son funciones continuas, luego integrables en cualquier conjunto compacto (como lo es $[0,1]$), luego podemos calcular dichas integrales.
        \end{itemize}
        Como las funciones resultantes de las composiciones siguientes
        \begin{gather*}
            (x,y,\lm) \longmapsto (x\lm, y\lm) \longmapsto P(x\lm, y\lm) \\
            (x,y,\lm) \longmapsto (x\lm, y\lm) \longmapsto Q(x\lm, y\lm) 
        \end{gather*}
        son de clase $C^1(\Omega\times [0,1])$, podemos aplicar dos veces el teorema de las integrales dependientes de un parámetro, obteniendo que $U\in C^1(\Omega)$ y que:
        \begin{align*}
            \dfrac{\partial U}{\partial x}(x,y) &= \int_{0}^{1} P(\lm x,\lm y)~d\lm  + x\int_{0}^{1} \lm \dfrac{\partial P}{\partial x}(\lm x,\lm y)~d\lm  + y\int_{0}^{1} \lm\dfrac{\partial Q}{\partial x}(\lm x,\lm y)~d\lm  \\
                                                &\AstIg \int_{0}^{1} P(\lm x,\lm y)~d\lm  + x\int_{0}^{1} \lm \dfrac{\partial P}{\partial x}(\lm x,\lm y)~d\lm  + y\int_{0}^{1} \lm\dfrac{\partial P}{\partial x}(\lm x,\lm y)~d\lm  
        \end{align*}
        Donde en $(\ast)$ hemos usado que $P$ y $Q$ cumplen la condición de exactitud. Podemos ahora escribirla como una diferencial exacta (compruébese), obteniendo que
        \begin{equation*}
            \dfrac{\partial U}{\partial x}(x,y) = \int_{0}^{1} P(\lm x,\lm y)~d\lm  + \int_{0}^{1} \lm\dfrac{d}{d\lm}[P(\lm x,\lm y)]~d\lm 
        \end{equation*}
        Que podemos volver a escribir como una diferencial exacta (vuélvase a comprobar), llegando a que
        \begin{equation*}
            \dfrac{\partial U}{\partial x}(x,y) = \int_{0}^{1} \dfrac{d}{d\lm}[\lm P(\lm x,\lm y)]~d\lm
        \end{equation*}
        donde podemos aplicar la Regla de Barrow:
        \begin{equation*}
        \dfrac{\partial U}{\partial x}(x,y) = \int_{0}^{1} \dfrac{d}{d\lm}[\lm P(\lm x,\lm y)]~d\lm = {\left[\lm P(\lm x,\lm y)\right]}_{\lm = 0}^{\lm = 1} = P(x,y)
        \end{equation*}
        Por un razonamiento análogo, llegamos a que:
        \begin{equation*}
            \dfrac{\partial U}{\partial y}(x,y) = Q(x,y)
        \end{equation*}
        Finalmente, como las dos derivadas parciales de $U$ son de clase $C^1(\Omega)$, concluimos que $U\in C^2(\Omega)$.
    \end{proof}
\end{teo}

\subsection{Interpretación de la demostración}
Pese a haber demostrado el Teorema~\ref{teo:condicion_suficiente}, la demostración no es gratificante, ya que hemos obtenido de forma ``mágica'' una función $U$ que cumplía lo que queríamos, y no sabemos de dónde proviene dicha fórmula. Trataremos en esta sección de dar sentido a esta, usando para ello la física.\\

\noindent
En física, un campo vectorial en el plano es una aplicación que a cada punto $z=(x,y)$ le hace corresponder un vector (una flecha), $F(z) = (F_1(x,y), F_2(x,y))$.\\

De esta forma, un campo vectorial para nosotros será una aplicación $F\in C^1(G, \mathbb{R}^2)$ con $G\subseteq \mathbb{R}^2$ un conjunto abierto.
Pensaremos en este campo vectorial como en un campo de fuerzas (es decir, el vector $F(z)$ nos indicará cómo es la fuerza que se sufre al estar en el punto $z$).

\begin{definicion}[Campo de fuerzas conservativo]
    Diremos que un campo de fuerzas $F$ es conservativo si existe un potencial, es decir, una función $U:G\rightarrow\mathbb{R}$ de clase $C^1$ tal que 
    \begin{equation*}
        \nabla U = F
    \end{equation*}

    Es decir:
    \begin{equation*}
        \dfrac{\partial U}{\partial x} = F_1 \qquad \dfrac{\partial U}{\partial y} = F_2
    \end{equation*}
\end{definicion}
\begin{observacion}
    El lector estará acostumbrado a ver en física el gradiente notado por $-\nabla V$ (con $V = -U$). Sin embargo, en esta sección trabajaremos con el gradiente refiriéndonos a $\nabla U$.
\end{observacion}

\begin{ejemplo}
    Dado el campo de fuerzas
    \begin{equation*}
        F(x_1,x_2) = \dfrac{1}{2}(x_1,x_2) \qquad \forall (x_1,x_2)\in \mathbb{R}^2
    \end{equation*}
    Que podemos pensar como una homotecia o como un campo vectorial:
    \begin{itemize}
        \item En el origen, tenemos el vector 0.
        \item Dado un punto $(x,y)$, tenemos que dibujar el vector fuerza (gradiente) como la mitad del vector de posición.
    \end{itemize}
    Notemos que se trata de un campo repulsor, de forma que el vector fuerza se mantiene constante en circunferencias de un determinado radio, con dirección perpendicular a los radios de la misma. Conforme nos alejamos del origen, la fuerza se incrementa.\\

    Resulta que $F$ es un campo de fuerzas conservativo, ya que podemos encontrar un potencial para dicho campo, es decir, una función $U\in C^1(\mathbb{R}^2)$ dada por
    \begin{equation*}
        U(x_1,x_2) = \dfrac{x_1^2 + x_2^2}{4} \qquad \forall (x_1,x_2)\in \mathbb{R}^2
    \end{equation*}

    de forma que
    \begin{equation*}
        \dfrac{\partial U}{\partial x}(x_1,x_2) = \dfrac{x_1}{2}= F_1(x_1,x_2) \qquad \dfrac{\partial U}{\partial y}(x_1,x_2) = \dfrac{x_2}{2} = F_2(x_1,x_2) \qquad \forall (x_1,x_2) \in \mathbb{R}^2
    \end{equation*}
\end{ejemplo}

\begin{ejemplo}
    Un ejemplo de campo no conservativo es
    \begin{equation*}
        F(x_1,x_2) = (-x_2, x_1)
    \end{equation*}
    Se trata de un giro de 90º en sentido antihorario, un campo de fuerzas que describe el comportamiento de un vórtice (como lo hace el agua cuando se cuela en un sumidero). Se trata de un campo no conservativo, ya que no podemos encontrar un potencial, debido a que no se cumple la condición de exactitud.
\end{ejemplo}

En un campo de fuerzas no hay necesariamente energía (ya que puede no ser conservativo), pero lo que siempre hay es trabajo.

\begin{definicion}[Trabajo]
    Dado un conjunto abierto $G\subseteq \mathbb{R}^2$, un campo de fuerzas en $G$ y un camino en $G$, es decir, una función $\gamma\in C^1([a,b])$, el trabajo de $F$ a lo largo de $\gamma$ se define como
    \begin{equation*}
        \int_{a}^{b} \langle F(\gamma(t), \gamma'(t)) \rangle~dt 
    \end{equation*}
\end{definicion}

A continuación, podemos reformular el Teorema~\ref{teo:condicion_suficiente} en términos físicos, obteniendo el siguiente teorema:

\begin{teo}
    Si $G\subseteq \mathbb{R}^2$ es abierto y tiene forma de estrella, sea $F\in C^1(G,\mathbb{R}^2)$ un campo de fuerzas para el cual se cumple la condición de exactitud:
    \begin{equation*}
        \dfrac{\partial F_1}{\partial x_2} = \dfrac{\partial F_2}{\partial x_1}
    \end{equation*}
    Entonces, $F$ es conservativo.
\end{teo}

Finalmente, notemos que si tenemos dos caminos distintos con los mismos extremos, el trabajo por cada uno de ellos no tiene por qué coincidir. Sin embargo, esto sucede si el campo es conservativo:
\begin{align*}
    \int_{a}^{b} \langle F(\gamma(t)), \gamma'(t) \rangle~dt  &= \int_{a}^{b} \left[\dfrac{\partial U}{\partial x_1}(\gamma(t))\gamma_1'(t) + \dfrac{\partial U}{\partial x_2}(\gamma(t))\gamma_2'(t)\right]~dt  = \\
                                                              &= \int_{a}^{b} \dfrac{d}{dt}[U(\gamma(t))]~dt = U(\gamma(b)) - U(\gamma(a))
\end{align*}
Por la regla de Barrow, concluimos que el trabajo para ir de un punto a otro por un camino $\gamma$ es la diferencia del potencial entre los dos puntos.\\

Para entender ahora la interpretación de lo que hicimos en la demostración del Teorema~\ref{teo:condicion_suficiente}, lo que hicimos fue fijar un nivel de potencial 0 en el origen $z_\ast = (0,0)$. Hemos cogido un camino rectilíneo entre cada punto $(x,y)$ de $\Omega$ y $z_\ast$ y hemos obtenido el trabajo para cada camino, sabiendo que el trabajo por cualquier otro camino se mantiene, al ser $F=(P, Q)$ un campo conservativo, por cumplir la condición de exactitud.

% // TODO: EDI

Veremos ahora cálculo en dos variables.

\begin{teo}[de Clairaut]
Sea $f\in C^2(G)$ con $G\subseteq \mathbb{R}^2$ abierto, buscamos probar
\begin{equation*}
    \dfrac{\partial^2 f}{\partial x\partial y} = \dfrac{\partial^2 f}{\partial y\partial x}
\end{equation*}
\begin{proof}
    Supongamos que $(0,0)\in G$ (en otro caso, se razona por traslación).

    Por ser $G$ abierto, existe $h\in \mathbb{R}$ tal que
    \begin{equation*}
        (0,0) \in [0,h]\times [0,h] \subseteq G
    \end{equation*}
    Sea $\Delta(h) = f(h,h)-f(0,h)-f(h,0)+f(0,0)$, tratamos de ver cómo es la función $\Delta$.

    Sea 
    \begin{equation*}
        G_h(x) = f(x,h) - f(x,0)
    \end{equation*}
    Entonces:
    \begin{equation*}
        \Delta(h) = G_h(h) - G_h(0)
    \end{equation*}

    Tenemos que $G$ es de clase $C^2$ 

    Aplicando el Teorema del Valor Medio:
    \begin{equation*}
        \Delta(h) = G_h(h) - G_h(0) = G'_h(\xi_h) h \qquad \xi_h \in [0,h]
    \end{equation*}
    \begin{equation*}
        G_h'(x) = \dfrac{\partial f}{\partial x}(x,h) - \dfrac{\partial f}{\partial x}(x,0)
    \end{equation*}
    Luego:
    \begin{equation*}
        \Delta(h) = h\left[\dfrac{\partial f}{\partial x}(\xi_h,h)-\dfrac{\partial f}{\partial x}(\xi_h,0)\right]
    \end{equation*}
    Y volvemos a aplicar el TVM, a la segunda variable:
    \begin{equation*}
        y \longmapsto \dfrac{\partial f}{\partial x}(\xi_h, y)
    \end{equation*}
    \begin{equation*}
        \Delta(h) = h^2 \dfrac{\partial^2 f}{\partial y\partial x}(\xi_h, \eta_h)
    \end{equation*}
    \begin{equation*}
        \lim_{h\to0} \dfrac{1}{h^2} \Delta(h) = \dfrac{\partial^2 f}{\partial y\partial x}(0,0)
    \end{equation*}
    donde hemos usado que la derivada segunda es continua:
    \begin{equation*}
        (\xi_h, \eta_h) \rightarrow (0,0) \text{\ cuando\ } h\rightarrow0
    \end{equation*}
    Si ahora en vez de $G$ definimos una función de $y$ por un razonamiento análogo, llegamos a la igualdad por unicidad del límite.
\end{proof}
\end{teo}

De aquí se sigue que la matriz Hessiana es una matriz $2\times 2$:
\begin{equation*}
    \left(\begin{array}{cc}
            \dfrac{\partial^2 f}{\partial x^2} & \dfrac{\partial^2 f}{\partial x\partial y} \\
            \dfrac{\partial^2 f}{\partial y\partial x} & \dfrac{\partial^2 f}{\partial y^2}
    \end{array}\right)
\end{equation*}
que gracias al Teorema de Clairaut es una matriz simétrica.

% // Terminado repaso 

A raíz del Teorema~\ref{teo:condicion_suficiente}, buscamos dar sentido a la función
\begin{equation*}
    U(x,y) = x\int_{0}^{1} P(\lm x,\lm y)~d\lm +y\int_{0}^{1} Q(\lm x,\lm y)~d\lm 
\end{equation*}
Dada una función $F:\Omega\rightarrow\mathbb{R}^2$ dada por
\begin{equation*}
    F(x,y) = (P(x,y),Q(x,y)) \qquad \forall (x,y)\in \mathbb{R}^2
\end{equation*}
Resulta que este campo de fuerzas es conservativo y como el trabajo en un campo conservativo es independiente del camino, observamos que lo que tenemos en la expresión de $U$ es el rabajo a lo largo del camino dado por el segmento $[(0,0),(x,y)]$, es decir:
\begin{equation*}
    \gamma(\lm) = (\lm x, \lm y) \qquad \lm \in [0,1]
\end{equation*}
\begin{equation*}
    \gamma'(\lm) = (x,y)
\end{equation*}

\begin{equation*}
    \int_{a}^{b} \langle F(\gamma(t)),\gamma'(t) \rangle~dt = \int_{0}^{1} [P(\lm x,\lm y)x + Q(\lm x,\lm y)y]~d\lm 
\end{equation*}
Además, puede probarse que $U$ es única salvo una constante aditiva (de aquí que en física el origen del potencial pueda situarse en cualquier punto).

Sin embargo, podemos elegir otro tipo de caminos que no sean los rectilíneos, sino parabólicos. Cosa que Ortega hace en exámenes.

% // 

Ahora, vemos que una vez que se sabe que existe el potencial, calcularlo es bastante fácil. Una opción es usar la fórmula, pero existe otro camino práctico.

\begin{ejemplo}
    Sean
    \begin{align*}
        P(x,y) &= 7x^6+6x^5y+3x^2y^3  \\
        Q(x,y) &= x^6+3x^3y^2 -4y^3
    \end{align*}
    dos funciones de clase $C^1(\mathbb{R}^2)$ por ser polinomios, $\mathbb{R}^2$ sabemos que tiene forma de estrella, comprobamos la condición de exactitud:
    \begin{align*}
        \dfrac{\partial P}{\partial y}(x,y) &= 6x^5+9x^2y^2 \\
        \dfrac{\partial P}{\partial x}(x,y) &= 6x^5+9x^2y^2
    \end{align*}
    Luego sabemos que existe el potencial $U$. Pasamos a calcularlo:\\

    Estamos buscando una función $U$ de forma que:
    \begin{equation*}
        \dfrac{\partial U}{\partial x}(x,y) = 7x^6+6x^5y+3x^2y^3
    \end{equation*}
    Ahora, integremos en $x$ pensando que la $y$ es fija:
    \begin{equation*}
        U(x,y) = \int (7x^6+6x^5y+3x^2y^3)~dx = x^7+x^6y+x^3y^3 + \phi(y)
    \end{equation*}
    Donde $\phi(y)$ es la constante de integración, la cual depende de $y$.
    Si ahora hacemos:
    \begin{equation*}
        \dfrac{\partial U}{\partial y}(x,y) = x^6+3x^3y^2 + \phi'(y) \AstIg x^6+3x^2y^2 -4y^3 = Q(x,y)
    \end{equation*}
    Donde en $(\ast)$ hemos usado la condición de exactitud.
    De donde $\phi'(y) = -4y^3$, por lo que $\phi(y) = -y^4$.
    Finalmente:
    \begin{equation*}
        U(x,y) = x^7+x^6y+x^3y^3 -y^4
    \end{equation*}
\end{ejemplo}

% // Ver por que es necesario estrella

Hay un teorema que dice que todos los abiertos simplemente conexos de $\mathbb{R}^2$ son difeomorfos a la bola.\\

Veamos un ejemplo donde no se puede buscar $U$ porque el dominio que consideramos no tiene forma de estrella (sabiendo lo de simplemente conexo, buscamos un agujero).
\begin{ejemplo}
    Tomaremos 
    \begin{equation*}
        \Omega = \left\{(x,y)\in \mathbb{R}^2 \mid \dfrac{1}{4}x^2+y^2 < 4\right\}
    \end{equation*}
    Es decir, el anillo formado por los puntos que están entre una circunferencia de radio $\nicefrac{1}{2}$ y radio $2$. % // TODO: Dibujar

    Sean:
    \begin{equation*}
        P(x,y) = \dfrac{y}{x^2+y^2} \qquad Q(x,y) = \dfrac{-x}{x^2+y^2}
    \end{equation*}
    Estas funciones en el plano entero no son $C^1$, pero sí en $\Omega$, luego $P,Q\in C^1(\Omega)$. De hecho, son de clase $C^\infty$.

    \begin{align*}
        \dfrac{\partial P}{\partial y}(x,y) &= \dfrac{x^2+y^2 - y(2y)}{{(x^2+y^2)}^{2}} = \dfrac{x^2-y^2}{{(x^2+y^2)}^{2}} \\
        \dfrac{\partial Q}{\partial x}(x,y) &= \dfrac{-x^2-y^2+2x^2}{{(x^2+y^2)}^{2}} = \dfrac{x^2-y^2}{{(x^2+y^2)}^{2}}
    \end{align*}
    con lo que tenemos la condición de exactitud en un ejemplo en el que $\Omega$ no es estrellado.

    Para ver que no existe el potencial, lo razonaremos por el trabajo, buscando un camino cerrado en el que el trabajo no sea nulo:

    \begin{align*}
        \int_{a}^{b} \langle F(\gamma(t)),\gamma'(t) \rangle~dt  &= \int_{a}^{b} \langle \nabla U(\gamma(t)), \gamma'(t) \rangle~dt   \\
                                                                 &= \int_{a}^{b} \dfrac{d}{dt}U(\gamma(t))~dt  = U(\gamma(b)) - U(\gamma(a))
    \end{align*}
    Cogeremos el camino que recorre la circunferencia de radio 1 (a poco que se piense, para que el camino sea bueno tiene que pasar por el circulo):
    \begin{equation*}
        \gamma(\theta) = (\cos\theta, \sen\theta) \qquad \theta \in [0,2\pi]
    \end{equation*}
    \begin{equation*}
        \gamma'(\theta) = (-\sen\theta,\cos\theta)
    \end{equation*}
    Con lo que el trabajo del campo $F=(P,Q)$ será:
    \begin{multline*}
        \int_{0}^{2\pi } \langle F(\gamma(\theta)),\gamma'(\theta) \rangle~d\theta = \int_{0}^{2\pi} [-P(\cos\theta,\sen\theta)\sen\theta + Q(\cos\theta,\sen\theta)\cos\theta]~d\theta  = \\
        = \int_{0}^{2\pi } [-\sen^2\theta-\cos^2\theta]~d\theta  = -2\pi \neq 0
    \end{multline*}
\end{ejemplo}

En un dominio sin agujeros, si fijamos un punto y escogemos caminos, podemos conectar todos los caminos de forma diferenciable.
Si tenemos agujeros, no tenemos una elección única de caminos para llegar al punto.
