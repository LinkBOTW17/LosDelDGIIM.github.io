\documentclass[12pt]{article}

\input{../../_assets/preambulo.tex}
\usetikzlibrary{er, fit}

\newcommand{\key}[1]{\ul{#1}}

% Definición de estilos
\tikzset{atributo/.style={attribute}}
\tikzset{entidad/.style={entity}}
\tikzset{relacion/.style={relationship}}
\tikzset{atributo derivado/.style={attribute, dashed}}
\tikzset{union discriminante/.style={dashed}}
\tikzset{entidad debil/.style={entidad, double distance=1.5 pt}}
\tikzset{participacion obligatoria/.style={double distance=1.5 pt}}
\tikzset{herencia/.style={draw, isosceles triangle, isosceles triangle apex angle=60, shape border rotate=230, minimum height=1cm, minimum width=1cm, fill=blue!20}}
\tikzset{agregacion/.style={draw, fit=#1, inner sep=0.5em}}


% Estilos estéticos
\tikzset{every entity/.style={draw=orange, fill=orange!20}}
\tikzset{every attribute/.style={draw=purple, fill=purple!20, font=\footnotesize}}
\tikzset{every relationship/.style={draw=green, fill=green!20, minimum height=2cm, minimum width=2cm}}

\begin{comment}
    \begin{tikzpicture}[node distance=6 em]
        \node [entidad](person){Person};
        \node [atributo derivado](pid) at (0.8,-2){\key{ID}} edge (person);
        \node [atributo](name) at (-0.8, -2) {Name} edge (person);
        \node [atributo](phone)[left of=person]{Phone} edge[union discriminante] (person);
        \node [atributo](address)[above left of=person]{Address} edge[-stealth] (person);
        \node [atributo](street)[above left of=address]{Street} edge (address);
        \node [atributo](city)[left of=address]{City} edge (address);
        \node [atributo](age)[above of=person]{Age} edge (person);
        \node [relacion](uses)[right of=person]{Uses} edge[participacion obligatoria] (person);
        \node [entidad debil](tool)[right of=uses]{Tool} edge (uses);
        \node [atributo](tid)[right of=tool]{\key{ID}} edge[Stealth-Stealth] (tool);
        \node [atributo](tname)[below of=tool]{Name} edge (tool);
    
        % Línea desde encima de Name hasta encima de ID
        \draw ([yshift=1em]name.north) -- ([yshift=1em]pid.north) node[circle, fill, inner sep=1.5pt] {};
    
        \node[agregacion=(A) (B) (R)] (box) {};
    
        \node [herencia, below of= B](H){} edge (B);
    \end{tikzpicture}
\end{comment}

% ---------------------------------------------------
\tikzset{
    CP/.style={
        overlay, text opacity=0, fill opacity=0,
        append after command={
            \pgfextra{
                \draw[thick] (\tikzlastnode.south west) -- (\tikzlastnode.south east);
                \node[below=0ex of \tikzlastnode] {CP};
            }
        }
    },
    CC/.style={
        overlay, text opacity=0, fill opacity=0,
        append after command={
            \pgfextra{
                \draw[thick] (\tikzlastnode.south west) -- (\tikzlastnode.south east);
                \node[below=0ex of \tikzlastnode] {CC};
            }
        }
    },
    CE/.style={
        overlay, text opacity=0, fill opacity=0,
        append after command={
            \pgfextra{
                \draw[thick, purple] (\tikzlastnode.north west) -- (\tikzlastnode.north east);
                \node[above=0ex of \tikzlastnode, text=purple] {CE};
            }
        }
    }
}

\begin{comment}
\begin{tikzpicture}
    \node (alumno) {Alumno(DNI, kjbbhjbj, Código, jhjghjh)};
    \node (asignatura) [below of=alumno, yshift=-5em] {Asignatura(hjbjhblj, jjgjhb, kgjhh, Código)};

    \node[CP, xshift=17.3ex] (codigoCP) at(asignatura) {Código};
    \node[CP, xshift=-9ex] (dniCP) at(alumno) {DNI};


    \node[CE, xshift=17.3ex] (codigoCE) at(asignatura) {Código};
    \draw[-Stealth, purple] (codigoCE.north west) -- (dniCP.south east);
    
\end{tikzpicture}
\end{comment}


\begin{document}

    % 1. Foto de fondo
    % 2. Título
    % 3. Encabezado Izquierdo
    % 4. Color de fondo
    % 5. Coord x del titulo
    % 6. Coord y del titulo
    % 7. Fecha

    
    \input{../../_assets/portada}
    \portadaExamen{ffccA4.jpg}{FBD\\Examen I}{FBD. Examen I}{MidnightBlue}{-8}{28}{2024-2025}{Arturo Olivares Martos}

    \begin{description}
        \item[Asignatura] Fundamentos de Bases de Datos.
        \item[Curso Académico] 2017-18.
        %\item[Grado] Doble Grado en Ingeniería Informática y Matemáticas.
        %\item[Grupo] Único.
        %\item[Profesor] Nicolás Marín Ruiz.
        \item[Descripción] Convocatoria Extraordinaria. Práctico Parcial 1 (Seminarios 1-2).
        %\item[Fecha] 8 de noviembre de 2021.
        % \item[Duración] 60 minutos.
    
    \end{description}
    \newpage



    Se trata de organizar la información relativa a una plataforma de control de actividad y monitoreo de actividad física. Los datos y restricciones a considerar son:
    \begin{itemize}
        \item Se desea guardar la información sobre los usuarios identificados por su e-mail y de los cuales se desea conocer su password, nombre, apellidos y edad.
        \item Un usuario puede tener uno o más dispositivos asociados, cada uno identificado por un código único.
        \item En particular interesa conocer en detalle los datos de sus móviles (número de teléfono, marca y modelo) y de su pulsera de actividad, de las cual se desea también saber marca y modelo.
        \item Cada pulsera puede monitorear en un día y hora determinados una actividad específica, identificada por un nombre. Hay sólo dos tipos de actividades: pasos y ritmo cardíaco. De los pasos se desea saber su cantidad, mientras que del ritmo cardíaco se desea conocer el número de pulsaciones por minuto.
        \item Se quiere poder registrar además las alertas que emiten las pulseras a un usuario en base a una actividad registrada. Por ejemplo: ``ritmo cardiaco elevado'' o ``meta de cantidad de pasos diaria alcanzada''.
        \item Finalmente se desea saber cuándo se sincroniza una pulsera de actividad. Suponemos que un móvil sólo puede sincronizarse con una pulsera, pero una pulsera sí puede sincronizarse con varios móviles.
    \end{itemize}

\begin{ejercicio}[$6$ puntos] Dibujar el esquema Entidad/Relación que represente adecuadamente dicha información.
\end{ejercicio}

\begin{ejercicio}[$2.5$ puntos] Elaborar el esquema relacional al que da lugar indicando las claves primarias, candidatas y externas correspondientes.
\end{ejercicio}

\begin{ejercicio}[$1$ punto] Fusionar aquellas tablas que semánticamente lo permitan.
\end{ejercicio}

\begin{ejercicio}[$0.5$ puntos] ¿El esquema obtenido permite que un pariente pueda recibir las alertas de la pulsera de su hijo/a? Justifique la respuesta.
\end{ejercicio}
\end{document}