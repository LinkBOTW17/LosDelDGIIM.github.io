\documentclass[12pt]{article}

\input{../../_assets/preambulo.tex}
\usetikzlibrary{er, fit}

\newcommand{\key}[1]{\ul{#1}}

% Definición de estilos
\tikzset{atributo/.style={attribute}}
\tikzset{entidad/.style={entity}}
\tikzset{relacion/.style={relationship}}
\tikzset{atributo derivado/.style={attribute, dashed}}
\tikzset{union discriminante/.style={dashed}}
\tikzset{entidad debil/.style={entidad, double distance=1.5 pt}}
\tikzset{participacion obligatoria/.style={double distance=1.5 pt}}
\tikzset{herencia/.style={draw, isosceles triangle, isosceles triangle apex angle=60, shape border rotate=230, minimum height=1cm, minimum width=1cm, fill=blue!20}}
\tikzset{agregacion/.style={draw, fit=#1, inner sep=0.5em}}


% Estilos estéticos
\tikzset{every entity/.style={draw=orange, fill=orange!20}}
\tikzset{every attribute/.style={draw=purple, fill=purple!20, font=\footnotesize}}
\tikzset{every relationship/.style={draw=green, fill=green!20, minimum height=2cm, minimum width=2cm}}

\begin{comment}
    \begin{tikzpicture}[node distance=6 em]
        \node [entidad](person){Person};
        \node [atributo derivado](pid) at (0.8,-2){\key{ID}} edge (person);
        \node [atributo](name) at (-0.8, -2) {Name} edge (person);
        \node [atributo](phone)[left of=person]{Phone} edge[union discriminante] (person);
        \node [atributo](address)[above left of=person]{Address} edge[-stealth] (person);
        \node [atributo](street)[above left of=address]{Street} edge (address);
        \node [atributo](city)[left of=address]{City} edge (address);
        \node [atributo](age)[above of=person]{Age} edge (person);
        \node [relacion](uses)[right of=person]{Uses} edge[participacion obligatoria] (person);
        \node [entidad debil](tool)[right of=uses]{Tool} edge (uses);
        \node [atributo](tid)[right of=tool]{\key{ID}} edge[Stealth-Stealth] (tool);
        \node [atributo](tname)[below of=tool]{Name} edge (tool);
    
        % Línea desde encima de Name hasta encima de ID
        \draw ([yshift=1em]name.north) -- ([yshift=1em]pid.north) node[circle, fill, inner sep=1.5pt] {};
    
        \node[agregacion=(A) (B) (R)] (box) {};
    
        \node [herencia, below of= B](H){} edge (B);
    \end{tikzpicture}
\end{comment}

% ---------------------------------------------------
\tikzset{
    CP/.style={
        overlay, text opacity=0, fill opacity=0,
        append after command={
            \pgfextra{
                \draw[thick] (\tikzlastnode.south west) -- (\tikzlastnode.south east);
                \node[below=0ex of \tikzlastnode] {CP};
            }
        }
    },
    CC/.style={
        overlay, text opacity=0, fill opacity=0,
        append after command={
            \pgfextra{
                \draw[thick] (\tikzlastnode.south west) -- (\tikzlastnode.south east);
                \node[below=0ex of \tikzlastnode] {CC};
            }
        }
    },
    CE/.style={
        overlay, text opacity=0, fill opacity=0,
        append after command={
            \pgfextra{
                \draw[thick, purple] (\tikzlastnode.north west) -- (\tikzlastnode.north east);
                \node[above=0ex of \tikzlastnode, text=purple] {CE};
            }
        }
    }
}

\begin{comment}
\begin{tikzpicture}
    \node (alumno) {Alumno(DNI, kjbbhjbj, Código, jhjghjh)};
    \node (asignatura) [below of=alumno, yshift=-5em] {Asignatura(hjbjhblj, jjgjhb, kgjhh, Código)};

    \node[CP, xshift=17.3ex] (codigoCP) at(asignatura) {Código};
    \node[CP, xshift=-9ex] (dniCP) at(alumno) {DNI};


    \node[CE, xshift=17.3ex] (codigoCE) at(asignatura) {Código};
    \draw[-Stealth, purple] (codigoCE.north west) -- (dniCP.south east);
    
\end{tikzpicture}
\end{comment}


\begin{document}

    % 1. Foto de fondo
    % 2. Título
    % 3. Encabezado Izquierdo
    % 4. Color de fondo
    % 5. Coord x del titulo
    % 6. Coord y del titulo
    % 7. Fecha

    
    \input{../../_assets/portada}
    \portadaExamen{ffccA4.jpg}{FBD\\Examen III}{FBD. Examen III}{MidnightBlue}{-8}{28}{2024-2025}{Arturo Olivares Martos}

    \begin{description}
        \item[Asignatura] Fundamentos de Bases de Datos.
        \item[Curso Académico] 2016-11.
        %\item[Grado] Doble Grado en Ingeniería Informática y Matemáticas.
        %\item[Grupo] Único.
        %\item[Profesor] Nicolás Marín Ruiz.
        \item[Descripción] Convocatoria Ordinaria. Práctico Parcial 1 (Seminarios 1-2).
        %\item[Fecha] 8 de noviembre de 2021.
        % \item[Duración] 60 minutos.
    
    \end{description}
    \newpage

Se trata de organizar la información que gestiona una empresa dedicada a la organización de espectáculos de música en verano. Con las siguientes condiciones:
\begin{enumerate}
    \item Los espectáculos están caracterizados por un código, un nombre (rock bajo estrellas, Jazz en la costa, etc.) y una descripción y pueden celebrarse varias veces en fechas distintas, en sedes distintas. Para cada celebración de un espectáculo se debe anotar la fecha de inicio, la fecha final y la hora de comienzo. Para cada sede se debe anotar un código, el nombre, tipo de sede (campo de deportes, plaza de toros, sala, etc.) y aforo.
    \item Para acudir a un espectáculo los clientes (identificados por DNI, Apellidos y Nombre, y teléfono), compran de forma telemática las entradas. Pueden comprarse varias entradas conjuntamente y se generaran mediante un código de compra al acudir al espectáculo, las entradas no están numeradas. En la compra se debe anotar, el número de entradas compradas, el código de compra, el importe total y el número de la tarjeta de crédito con la que se paga.
    \item Un espectáculo puede estar compuesto de una o varias actuaciones, cada actuación dentro de un espectáculo está caracterizada por un número de orden dentro del espectáculo, y la duración de la misma.
    \item Las actuaciones las realizan intérpretes. Los intérpretes puede ser solistas o grupos. Un solista puede unirse a un grupo, anotándose la fecha de su inclusión en el grupo y la fecha, en su caso, de su separación.
\end{enumerate}

\begin{ejercicio}
    Realizar un diagrama E/R que refleje los datos descritos de la manera más detallada posible.
\end{ejercicio}
\begin{ejercicio}
    Pasar el diagrama a un esquema de base de datos relacional especificando llaves primarias, candidatas y externas y realizando las fusiones de tablas que sean necesarias.
\end{ejercicio}
\end{document}